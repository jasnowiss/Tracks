<!DOCTYPE html>
<html>
  <head>

    <!--Reference to Jquery 1.11.0 Library -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>

    <!-- Reference to JqueryUI 1.10.4 Library -->
    <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>

    <!-- Reference to JqueryUI 1.10.4 CSS -->
    <link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.css">

    {% url 'Tracks:upload_MP3' as upload_mp3_url %}
    {% url 'Tracks:userprofile' as userprofile_url %}
    {% url 'Tracks:userpage' as userpage_url %}
    {% url 'Tracks:get_tracks_for_current_user_JSON' as get_tracks_for_current_user_JSON_url %}
    {% url 'Tracks:finalize_collaboration' as finalize_collaboration_url %}
    {% url 'Tracks:delete_track_from_server' as delete_track_from_server_url %}
    {% url 'Tracks:get_collab_settings_JSON' as get_collab_settings_JSON_url %}
    {% url 'Tracks:change_permission_of_collab' as change_permission_of_collab_url %}
    {% url 'Tracks:add_user_to_collab' as add_user_to_collab_url %}
    {% url 'Tracks:remove_user_from_collab' as remove_user_from_collab_url %}
    {% url 'Tracks:webAudio' as webAudio_url %}
    {% url 'Tracks:record' as record_url %}

    {% load tracks_extras %}
    {% load staticfiles %}

    <!-- Script to setup url usage in .js files -->
    <script>
        resolve_to_url = [];
        resolve_to_url["upload_mp3_url"] = "{{ upload_mp3_url }}";
        resolve_to_url["userprofile_url"] = "{{ userprofile_url }}";
        resolve_to_url["userpage_url"] = "{{ userpage_url }}";
        resolve_to_url["get_tracks_for_current_user_JSON_url"] = "{{ get_tracks_for_current_user_JSON_url }}";
        resolve_to_url["finalize_collaboration_url"] = "{{ finalize_collaboration_url }}";
        resolve_to_url["delete_track_from_server_url"] = "{{ delete_track_from_server_url }}";
        resolve_to_url["get_collab_settings_JSON_url"] = "{{ get_collab_settings_JSON_url }}";
        resolve_to_url["change_permission_of_collab_url"] = "{{ change_permission_of_collab_url }}";
        resolve_to_url["add_user_to_collab_url"] = "{{ add_user_to_collab_url }}";
        resolve_to_url["remove_user_from_collab_url"] = "{{ remove_user_from_collab_url }}";
        resolve_to_url["webAudio_url"] = "{{ webAudio_url }}";
        resolve_to_url["record_url"] = "{{ record_url }}";
        resolve_to_url["MEDIA_URL"] = "{{ MEDIA_URL }}";
     </script>

    <link href={% static "bootstrap-3.1.1-dist/css/bootstrap.min.css" %} rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href={% static "starter-template.css" %} rel="stylesheet">

    <!-- Core styles for the UI representing Tracks models -->
    <link href={% static "core-styles.css" %} rel="stylesheet">

    <!-- Core js functions for interacting with the UI representing Tracks models -->
    <script src={% static "core-functions.js" %} type="text/javascript"></script>

    <!-- Universal js functions -->
    <script src={% static "sidebar.js" %} type="text/javascript"></script>

  </head>

  <body>
    <div id="navbar" class="navbar navbar-inverse navbar-fixed-top" role="navigation"></div>

    {% if not is_disabled %}
      Hello {{ user.get_name_to_display }}!
      <a href="{{ userprofile_url }}"> Edit Profile </a>
    {% else %}
      Viewing page of {{ user.get_name_to_display }}
      <a href="{{ userprofile_url }}{{ user.id }}"> View Profile </a>
    {% endif %}

    <br>

    <h3>Collaborations</h3>
    <ul id="collaborations_list">
      {% for collaboration in list_of_collaborations %}
        <li>
          <div id="{{ collaboration.id }}" class="collab_div_container collab_pause">
            <div class="collab_info_div">
                Collaboration {{ collaboration.id }}
                <button name="collab_{{ collaboration.id }}" class="play_collab_button">Play</button>
                <button name="collab_{{ collaboration.id }}" class="restart_collab_button">Restart</button>
                <!-- may need to change in future iteration  account for a master_user of collab -->
                {% if collaboration.is_public == False and collaboration|is_user_authorized:session_user.id %}
                    <button>Edit</button>
                {% elif collaboration.is_public %}
                    <button>Edit</button>
                {% endif %}

                <!-- need to change in future iteration to account for a master_user of collab -->
                {% if collaboration|is_user_authorized:session_user.id %}
                    <button class="settings_button">Settings</button>
                {% endif %}
              <!-- REMEMBER TO ADD FUNCTIONALITY -->
            </div>

            <div class="collab_users_div">
              <div class="collab_users_div_inner_left">
                ft. {{ collaboration|get_formatted_list_of_collab_users }}
              </div>
              <a class="collab_toggle_all_tracks" href="javascript:;">see all tracks</a>
              <span></span>
            </div>

            <div class="collab_tracks_div">
              <a class="collab_toggle_all_tracks" href="javascript:;">hide all tracks</a>
              <ul>
                {% for track in collaboration.tracks.all %}
                  <li> {{ track.filename }} by <a href="{{ userpage_url }}{{ track.user.id }}">{{ track.user.get_name_to_display }}</a>
                    <button name="{{ track|get_server_filename }}" class="show_hide_player_button">Show Player</button>
                    {% if collaboration.is_public == False and collaboration|is_user_authorized:session_user.id %}
                        <button name= "{{ track.id }}" class="remove_track_from_collab_button">X</button>
                    {% elif collaboration.is_public and track.user.id == session_user.id %}
                        <button name= "{{ track.id }}" class="remove_track_from_collab_button">X</button>
                    {% endif %}
                  </li>
                {% endfor %}

                {% if collaboration.is_public or collaboration|is_user_authorized:session_user.id %}
                <li>
                  <button class="collaborate_button">Collaborate</button>
                </li>
                {% endif %}
              </ul>
            </div>
          </div>
        </li>
      {% endfor %}
    </ul>

    <h3>Tracks</h3>
    <ul id="tracks_list">
      {% for track in list_of_tracks %}
        <li class="tracks_list_item">
          <span>{{ track.filename }} </span>
          <button name="{{ track|get_server_filename }}" class="show_hide_player_button">Show Player</button>
          <button name="{{ track.id }}" class="collaborate_button">Collaborate</button>
          {% if not is_disabled %}
            <button name="{{ track.id }}" class="edit_button">Edit</button>
            <button name= "{{ track.id }}" class="delete_track_from_server_button">X</button>
          {% endif %}
        </li>
      {% endfor %}
      <!--<h3 class="noindent">Upload Track</h3>-->
      {% if not is_disabled %}
        <li class="tracks_list_authorized_buttons_item">
          <h3 class="noindent">Upload Track</h3>
          <!--<div class="fileUpload btn btn-default">
            <span>Upload</span>
            <input class="upload" type="file" />
          </div> -->
          <form action="javascript:;" method="post" class="fileUpload btn btn-primary">
            {% csrf_token %}
            {% for field in form %}
              {{ field.errors }}
              {{ field }}
              Upload
            {% endfor %}
          </form>
          <button onclick="window.location='{{ record_url }}'" class="btn btn-danger">Record</button>
        </li>
      {% else %}
        <form action="javascript:;" method="post">
          {% csrf_token %}
        </form>
      {% endif %}
    </ul>

    <div id="settings_div">
        <form id="settings_form" action="javascript:;" method="post">
            {% csrf_token %}
        </form>
    </div>


    <!-- JS file containing function bindings for the events that can be triggered on this page -->
    <script src={% static "userpage-bindings.js" %} type="text/javascript"></script>

    <script src={% static "bootstrap-3.1.1-dist/js/bootstrap.min.js" %}></script>

    <script type="text/javascript">
        addNav(true);
    </script>

  </body>
</html>